process test = {

  untracked PSet maxEvents = {untracked int32 input = 2 }

  include "FWCore/MessageService/data/MessageLogger.cfi"
  include "Configuration/ReleaseValidation/data/Services.cff"
  include "Configuration/StandardSequences/data/Reconstruction.cff"
  include "Configuration/StandardSequences/data/FakeConditions.cff"	
  include "Configuration/StandardSequences/data/Simulation.cff"
  #include "Configuration/StandardSequences/data/MixingNoPileUp.cff" 

  ### for the validator 
  # Track Associators
  include "SimTracker/TrackAssociation/data/TrackAssociatorByChi2.cfi"
  include "SimTracker/TrackAssociation/data/TrackAssociatorByHits.cfi"

  include "Validation/RecoTrack/data/cutsTPEffic.cfi"
  include "Validation/RecoTrack/data/cutsTPFake.cfi"
  include "Validation/RecoTrack/data/MultiTrackValidator.cff"

  module cutsCKF = TrackMultiSelector {
     InputTag src      = ctfWithMaterialTracks

     InputTag vertices    = pixelVertices
     int32    vtxNumber   = -1 
     uint32   vtxTracks   = 3     // at least 3 tracks
     double   vtxChi2Prob = 0.01  // at least 1% chi2nprobability (if it has a chi2)

     VPSet cutSets = {
        {  // old PTDR validation cuts
           vuint32 validHits = { 8  , 999999 }
           vuint32 lostHits  = { 0  , 999999 }
           vdouble chi2n     = { 0  , 999999 }
           vdouble pt        = { 0.8, 999999 }
           double  d0        = 3.5
           double  dz        = 30  },
        {  // less hits but vertex association
           vuint32 validHits = { 6  , 7      }
           vuint32 lostHits  = { 0  , 999999 }
           vdouble chi2n     = { 0  , 999999 }
           vdouble pt        = { 0.5, 999999 }
           double  d0        = 0.2
           double  dz        = 1.0 },
        {  // even less hits, but decent track 
           vuint32 validHits = { 4  , 5      }
           vuint32 lostHits  = { 0  , 0      }
           vdouble chi2n     = { 0  , 100    }
           vdouble pt        = { 0.5, 999999 }
           double  d0        = 0.2
           double  dz        = 1.0 }
     } // end of cut sets

     untracked bool copyExtras       = true  // set to false on AOD
     //untracked bool copyTrajectories = true // when doing retracking before
     untracked bool copyTrajectories = false  // when not doing retracking
     untracked bool splitOutputs     = false
  }
 
  source = PoolSource  { 
    untracked vstring fileNames = {'file:input.root'}
  }


  include "RelValTTbar.cff"
  replace multiTrackValidator.out = "val.RelValTTbar.root"	
  replace multiTrackValidator.associators = {"TrackAssociatorByHits"}
  replace multiTrackValidator.label = {cutsCKF, ctfWithMaterialTracks }

  sequence digi2track =   {
   siPixelClusters,siPixelRecHits, siStripClusters,siStripMatchedRecHits,
   globalMixedSeeds,ckfTrackCandidates,ctfWithMaterialTracks,
   cutsCKF,cutsTPEffic,cutsTPFake,
   multiTrackValidator
  }

  sequence re_tracking =   {
   siStripClusters,siStripMatchedRecHits,
   globalMixedSeeds,
   ckfTrackCandidates,ctfWithMaterialTracks,
   cutsCKF,cutsTPEffic,cutsTPFake,
   multiTrackValidator
  }
 
  sequence only_validation = {
   cutsCKF,cutsTPEffic,cutsTPFake,
   multiTrackValidator
  }

  path p = {
      only_validation
  }

}
